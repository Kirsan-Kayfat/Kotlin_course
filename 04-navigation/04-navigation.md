# Навигация в приложении

## Оглавление

- [Введение](#введение)
- [Fragments](#fragments)
- [Реализация навигации](#реализация-навигации)
	- [Добавление нового фрагмента](#добавление-нового-фрагмента)
- [ActionBar-меню](#actionbar-меню)
- [Интенты и передача данных через интенты](#интенты-и-передача-данных-через-интенты)

## Введение

Для работы с навигацией между экранами в Android-приложении применяется библиотека **Navigation Architecture Component**. Она входит в набор Android Jetpack и помогает реализовать навигацию, от простых нажатий на кнопки до более сложных, таких как панели приложений (action bars) и панель навигации (navigation drawers).

Библиотека предоставляет ряд преимуществ:
* Корректная обработка кнопок «Вверх» и «Назад» по умолчанию
* Поведение по умолчанию для анимации и переходов.
* Реализация шаблонов навигации пользовательского интерфейса (таких как navigation drawer).
* Безопасность типов при передаче информации во время навигации.
* Инструменты Android Studio для визуализации и редактирования navigation flow приложения.

В качестве примера будет использоваться готовый проект, в котором уже есть все необходимые экраны, их макеты и исходные коды. Необходимо будет лишь разобраться с навигацией между экранами.

Тестовое приложение представляет собой мини-викторину. Оно будет иметь несколько экранов:
* Стартовый экран с логотипом и кнопкой "Play".
* Экран с вопросами и вариантами ответа.
* Экран с кнопкой "Try Again" в случае ошибки.
* Экран с кнопкой "Next Match" в случае успешного прохождения теста.
* Экран "About" с информацией о приложении.
* Экран "Rules" с текстом правил приложения.

Стартовый проект с приложением содержит все эти экраны, но не содержит связей между ними, их создание будет рассмотрено далее. Каждое описанный экран — это фрагмент. Фрагмент — особый компонент системы Android. Прежде чем начать разбираться с навигацией по фрагментам, нужно разобраться с тем, что это такое.

## Fragments

Фрагмент (класс `Fragment`) предоставляет часть пользовательскоого интерфейса в активности (`Activity`). Активности могут содержать как несколько фрагментов внутри себя, так и один фрагмент. Обычно несколько фрагментов в одной активности располагают при разработке приложения для планшетов, когда для меню навигации и для основного контента выделются отдельные фрагменты, располагающиеся на экране одновременно.

![](fragments.png)

Фрагменты имеют свой отдельный жизненный цикл и самостоятельно отдельно от активностей занимаются обработкой событий ввода.

Обычно фрагменты имеют собственные макеты (layouts), описывающие элементы пользовательского интерфейса. Если в активностях инициализация и установка макетов выполняется в методе `onCreate()`, то в фрагментах — в методе `onCreateView()` общем для всех фрагментов. Вместо метода `setContentView()` для установки макета здесь используется метод `inflate()`, принимающий на вход ссылку на ресурс с макетом, объект `container`, являющийся родительским видом и булево значение, определяющиее нужно ли новый макет привязать к корневому (в большинстве случаев используется `false`).

```kotlin
class ExampleFragment : Fragment() {

    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?, 
                              savedInstanceState: Bundle?): View {
        // Inflate the layout for this fragment
        return inflater.inflate(R.layout.example_fragment, container, false)
    }
}
```

Для добавления фрагмента в активность необходимо описать тэг `<fragment>` в макете активности.

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:orientation="horizontal"
    android:layout_width="match_parent"
    android:layout_height="match_parent">
    <fragment android:name="com.example.news.ExampleFragment"
            android:id="@+id/example_fragment"
            android:layout_weight="1"
            android:layout_width="0dp"
            android:layout_height="match_parent" />
</LinearLayout>
```

Существует подклассы фрагментов: `ListFragment`, `DialogFragment`, `PreferenceFragment`, `WebViewFragment` и др., упрощающие реализацию и работу с конкретными типами окон: списками, диалоговыми окнами, настройками и веб-содержимым, соответственно.

Именно фрагменты чаще используются в качестве компонентов, описывающих экраны приложения, располагаясь в одной или паре активностей, в зависимости от задач приложения. Фрагменты позволяют настраивать боковые панели навигации (navigation drawer) и ActionBar-меню. Фрагменты упрощают вопрос навигации и передачи данных между экранами приложения. Также создание фрагментов — наиболее выгодно с точки зрения траты ресурсов системы, чем создание активностей.

## Реализация навигации

Перейдем к вопросам реализации навигации между экранами приложения.

Сперва необходимо скачать и собрать стартовый проект **trivia-starter-code**. Стартовый проект уже содержит почти все необходимые фрагменты (кроме одного), все необходимые макеты, создавать их не нужно. Необходимо сосредоточиться исключительно на навигации.

### Добавление нового фрагмента

Единственный фрагмент, которого не хватает в стартовом проекте — это фрагмент с начальным экраном приложения `TitleFragment`. Для его создания необходимо выполнить следующие шаги:

1. File -> New -> Fragment -> Fragment (Blank).
2. Fragment Name: `TitleFragment`.
3. Убрать галочки "Create layout XML?", "Include fragment factory methods?" и "Include interface callbacks?" Макет для этого фрагмента уже есть в стартовом проекте.
4. Нажать "Finish".

Далее необходимо заменить код, сгенерированный автоматически для настройки макета фрагмента (`return TextView(activity).apply`), на использование метода `DataBindingUtil.inflate()`. Это позволит нам и инициализировать макет для фрагмента и использовать в дальнейшем Data Binding.

Определение метода `onCreateView()` должно выглядеть следующим образом:

```kotlin
override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,
                          savedInstanceState: Bundle?): View? {
    val binding = DataBindingUtil.inflate<FragmentTitleBinding>(
    	inflater, R.layout.fragment_title, container, false)
    return binding.root
}
```

И в конце необходимо поместить фрагмент с начальным экраном на `MainActivity`, чтобы его можно было отобразить.

```xml
<fragment
    android:id="@+id/titleFragment"
    android:name="com.example.android.navigation.TitleFragment"
    android:layout_width="match_parent"
    android:layout_height="match_parent" />
```

После запуска приложения на экране отобразится содержимое `TitleFragment` — начальный экран с логотипом и кнопкой "Play". По нажатию на кнопку ничего не выполняется.

## ActionBar-меню

## Интенты и передача данных через интенты

